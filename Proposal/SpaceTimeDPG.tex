% -*- root: Proposal.tex -*-
\documentclass[Proposal.tex]{subfiles} 
\begin{document}
\chapter{Space-time DPG}
We summarize some completed work on space-time DPG. At the time of writing, Camellia does not officially support space-time computations, but we can fake it for 1D spatial problems by pretending the $y$-direction is time.
Complications arise when the PDE under consideration is of a different type temporally then it is spatially. 
For example, the heat equation is elliptic in space, but hyperbolic in time. 
Mathematically, this leaves traces undefined on element edges without a spatial normal component. 
Practically, this means that we have had to hack the Camellia code in order to support these ``spatial traces''.
We say that the code was ``hacked'' to indicate that we modified the code in an ``ugly'' manner in order to obtain the following results, 
but the plans are to do this in according to better software practices in the proposed work, since the current implementation is not very maintainable.

\section{Pure Convection}
The pure convection equation is 
\begin{equation}
\frac{\partial u}{\partial t}+\Div(\bfbeta u)=f\,,
\end{equation}
where $u$ is the unknown being convected, $\bfbeta$ is the convection vector, and $f$ is the source term.
The convenient thing about pure convection is that the equation is the time dimension is basically indistinguishable from the spatial dimensions. 
In fact, we can rewrite this in terms of a space-time divergence operator $\Divxt(u):=\Div(u)+\frac{\partial u}{\partial t}$:
\[
\Divxt\LRp{\vecttwo{\bfbeta}{1}u}=f\,.
\]
This means that spatially 1D space-time convection with convection vector $\alpha$ is identical to 2D steady convection with convection vector $\LRp{\alpha,1}^T$.

We derive an ultra-weak DPG formulation for pure convection with $\bfbeta=\LRp{\alpha,1}^T$. 
Multiplying by test function $v$ and integrating by parts over each element $K$, we get
\begin{equation}
-\LRp{\vecttwo{\alpha}{1}u,\Gradxt v}+\LRa{\hat t, v}=\LRp{f,v}\,,
\end{equation}
where $\hat t=\trace\LRp{\LRp{\alpha,1}^T\cdot\bfn\,u}$.

\section{Heat equation}
The simplest space-time problem we can consider where the the spatial and temporal dimensions are treated differently is the heat equation.
We start with a general $n$-dimensional spatial derivation and later simplify to spatially 1D with a few numerical experiments.

\subsection{Derivation}
Let $\Omega(t)\subset\mathbb{R}^d$ be the spatial domain with boundary $\partial\Omega$.
The heat equation is
\begin{equation}
	\frac{\partial u}{\partial t}-\epsilon\Delta u=f\,,\quad\bfx\in\Omega\,,\;t\in(t_0,T)
\end{equation}
where $u$ is unknown heat, $\epsilon$ is the diffusion scale, $f$ is the source term, $t_0$ is the start time, and $T$ is the final time.
Let $Q\subset\mathbb{R}^{d+1}$ denote the full space-time domain which is then tessellated into space-time elements $K$.

Let us proceed as usual and form a system of first order equations:
\begin{equation}
\label{eq:heatFirstOrder}
\begin{aligned}
\bfsigma-\epsilon\Grad u&=0\\
\frac{\partial u}{\partial t}-\Div\bfsigma&=f\,.
\end{aligned}
\end{equation}
Let us say that $f\in\LQ$, then we seek $u$, and $\bfsigma$ such that $u,\,\bfsigma,\,\Grad u,\,\frac{\partial u}{\partial t}-\Div\bfsigma\in\LQ$.
Notice that this is a weaker condition than saying $\frac{\partial u}{\partial t}\in\LQ$ and $\Div\bfsigma\in\LQ$.
It helps to view $\bfU:=(-\bfsigma, u)$ as a group variable in space-time. 
Then the last condition is telling us that $\Divxt\bfU\in\LQ$, or that $\bfU\in\HdivQ$.
That is to say the normal component $-\bfsigma\cdot\bfn_x+u\cdot n_t$ (which we call the flux) is continuous across element faces, 
where $\bfn=(\bfn_x,n_t)^T$ is the full space-time normal vector for element $K$.
Now consider the condition that $\Grad u\in\LQ$.
This implies that $u$ lives in a tensor product space of $H^1$ spatially and $L^2$ temporally and that
$u\cdot n_t$ is continuous on element faces where $n_t$ is nonzero; we call this the spatial trace.

Now that we understand which Sobolev spaces $u$ and $\bfsigma$ live in, we can proceed with a derivation of the space-time DPG formulation for this problem.
We multiply the first equation in \eqref{eq:heatFirstOrder} by test function $\bftau$ and the second by $v$. Then we integrate by parts over each element:
\begin{equation}
\label{eq:heatBF}
	\begin{aligned}
		\LRp{\bfsigma,\bftau}+\epsilon\LRp{u,\Div\bftau}-\LRa{\hat u,\tau_n}&=0\\
		-\LRp{u,\frac{\partial v}{\partial t}}+\LRp{\bfsigma,\Grad v}-\LRa{\hat t,v}&=\LRp{f,v}\,,
	\end{aligned}
\end{equation}
where $\hat u$ is the spatial trace and $\hat t$ is the flux.
The second equation could alternatively be written in terms of the group variable $\bfU$:
\begin{equation}
\label{heatBFAlt}
-\LRp{\bfU,\Gradxt v}-\LRa{\hat t,v}=\LRp{f,v}\,.
\end{equation}
This alternate version emphasizes the definition of the flux: $\hat t=\trace\LRp{-\bfsigma\cdot\bfn_x+u\cdot n_t}$.
From \eqref{eq:heatBF} and \eqref{heatBFAlt} it is clear that $\bftau\in\HdivK$ where the divergence is taken only over spatial directions, and $v\in\HOneK$.
Figure \ref{fig:heatMesh} illustrates the support for the fluxes and spatial traces. Notice that the fluxes live on all element boundaries, while the spatial traces only live on ``non-horizontal'' edges.

\begin{figure}[h!]
\begin{tikzpicture}[line cap=round,line join=round,>=triangle 45,x=2.0cm,y=2.0cm]
\clip(-0.7,-1.01) rectangle (5.27,2.29);
\draw (0,2)-- (0,0);
\draw (0,0)-- (1,0);
\draw (1,0)-- (4,0);
\draw (4,0)-- (5,0);
\draw (5,0)-- (5,2);
\draw (5,2)-- (3,2);
\draw (3,2)-- (2,2);
\draw (2,2)-- (0,2);
\draw (1,0)-- (1.5,1);
\draw (1.5,1)-- (2,2);
\draw (1.5,1)-- (3.5,1);
\draw (3,2)-- (3.5,1);
\draw (3.5,1)-- (4,0);
\draw (-0.21,0.9) node[anchor=south west] {$\hat u$};
\draw (4.82,0.9) node[anchor=south west] {$\hat u$};
\draw (3.5,0.45) node[anchor=south west] {$\hat u$};
\draw (1.0,0.45) node[anchor=south west] {$\hat u$};
\draw (1.5,1.4) node[anchor=south west] {$\hat u$};
\draw (3.0,1.4) node[anchor=south west] {$\hat u$};
\draw (0.05,0.9) node[anchor=south west] {$\hat t$};
\draw (1.40,0.45) node[anchor=south west] {$\hat t$};
\draw (3.79,0.45) node[anchor=south west] {$\hat t$};
\draw (2.47,1.0) node[anchor=south west] {$\hat t$};
\draw (3.33,1.4) node[anchor=south west] {$\hat t$};
\draw (1.89,1.4) node[anchor=south west] {$\hat t$};
\draw (5.07,0.9) node[anchor=south west] {$\hat t$};
\draw (4.44,0.0) node[anchor=south west] {$\hat t$};
\draw (2.46,0.0) node[anchor=south west] {$\hat t$};
\draw (0.45,0.0) node[anchor=south west] {$\hat t$};
\draw (2.44,1.7) node[anchor=south west] {$\hat t$};
\draw (0.76,1.7) node[anchor=south west] {$\hat t$};
\draw (4.21,1.7) node[anchor=south west] {$\hat t$};
\draw [->] (-0.5,-0.5) -- (-0.5,0);
\draw [->] (-0.5,-0.5) -- (0,-0.5);
\draw (-0.54,0.29) node[anchor=north west] {$t$};
\draw (0.07,-0.35) node[anchor=north west] {$x$};
\end{tikzpicture}
\caption{Support of flux and spatial trace variables}
\label{fig:heatMesh}
\end{figure}

\subsection{Problems considered}


\section{Convection-diffusion}

\subsection{Derivation}

\subsection{Problems considered}


\section{Burgers'}

\subsection{Derivation}

\subsection{Problems considered}


\section{Time-slabs vs full-time}
\end{document}